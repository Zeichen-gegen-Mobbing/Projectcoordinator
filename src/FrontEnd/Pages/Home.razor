@page "/"
@using Microsoft.AspNetCore.Authorization
@using FrontEnd.Services
@using Microsoft.AspNetCore.Components
@attribute [Authorize]

@inject IRoleService RoleService
@inject NavigationManager NavigationManager

<PageTitle>Projectcoordinator</PageTitle>

<h1>Willkommen beim Projektkoordinator</h1>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">
                    <span class="bi bi-geo-alt-fill text-primary"></span> Projektkoordination - Reisen berechnen
                </h5>
                <p class="card-text">
                    Die Projektkoordination kann die Reisedauer von allen gespeicherten Orten zu einem Zielort
                    automatisch berechnen.
                    So findet sie schnell heraus, wer am besten geeignet ist, einen Workshop wahrzunehmen.
                </p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">
                    <span class="bi bi-pin-map-fill text-success"></span> SoVi - Orte verwalten
                </h5>
                <p class="card-text">
                    Social Visionaries können ihre häufig besuchten Orte speichern und verwalten. Diese Orte werden für
                    die
                    Reiseberechnung verwendet, um optimale Zuordnungen zu finden.
                </p>
            </div>
        </div>
    </div>
</div>

<div class="alert alert-info mt-4" role="alert">
    <strong>Hinweis:</strong> Du siehst diese Seite, weil du noch keine Rolle zugewiesen bekommen hast oder die
    Anwendung gerade lädt.
    Warte einen Moment, klicke auf Home im Navigationsmenü oder melde dich ab und wieder an.
    Sollte das Problem weiterhin bestehen, kontaktiere bitte den Support.
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        if (!IsInitialNavigation())
        {
            return;
        }

        try
        {
            if (await RoleService.HasRole("admin"))
            {
                NavigationManager.NavigateTo("/admin/places");
            }
            else if (await RoleService.HasRole("projectcoordination"))
            {
                NavigationManager.NavigateTo("/trips");
            }
            else if (await RoleService.HasRole("socialvisionary"))
            {
                NavigationManager.NavigateTo("/my-places");
            }
        }
        catch
        {
            // If role check fails, stay on home page
        }
    }

    private bool IsInitialNavigation()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        return uri.PathAndQuery == "/" || uri.PathAndQuery == "";
    }
}