@using ZgM.ProjectCoordinator.Shared
@using FrontEnd.Services
@inject IPlaceService PlaceService

<div class="mb-3">
    <label for="placeName" class="form-label">Place Name</label>
    <input type="text" class="form-control" id="placeName" @bind="placeName" @bind:event="oninput"
        placeholder="Enter place name" />
</div>

<div class="mb-3">
    <label for="transportMode" class="form-label">Transport Mode</label>
    <select class="form-select" id="transportMode" @bind="transportMode">
        <option value="">-- Select Transport Mode --</option>
        <option value="@TransportMode.Car">ðŸš— Car</option>
        <option value="@TransportMode.Train">ðŸš† Train</option>
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Location</label>
    <LocationSelector OnLocationSelected="CreatePlace" DisableSelect="@(!CanCreate)" SelectButtonText="Create"
        SelectModalButtonText="Create" ExternalErrorMessage="@errorMessage" />
</div>

@if (errorMessage != null)
{
    <div class="alert alert-danger" role="alert">
        @errorMessage
    </div>
}

@code {
    [Parameter, EditorRequired]
    public UserId UserId { get; set; } = default!;

    [Parameter]
    public EventCallback<Place> OnPlaceCreated { get; set; }

    [Parameter]
    public EventCallback OnCancel { get; set; }

    private string placeName = "";
    private TransportMode? transportMode = null;
    private string? errorMessage;

    private bool CanCreate => !string.IsNullOrWhiteSpace(placeName) && transportMode.HasValue;

    private async Task CreatePlace(LocationSearchResult result)
    {
        if (!CanCreate)
        {
            return;
        }

        try
        {
            errorMessage = null;
            var place = await PlaceService.CreatePlaceAsync(
            UserId,
            placeName,
            result.Latitude,
            result.Longitude,
            transportMode!.Value);

            placeName = "";
            transportMode = null;
            await OnPlaceCreated.InvokeAsync(place);
        }
        catch (Exception ex)
        {
            errorMessage = $"Failed to create place: {ex.Message}";
        }
    }
}